<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
<html>
 
<head>
 
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 
	<title>Annual Report for Toxics Reduction</title>
 
    <!--PRIMARY-->
    <meta name="dc.title" content="" />
    <meta property="og:title" content="" />
    <meta name="dc.description" content="" />
    <meta name="description" content="" />
    <meta name="dcterms.audience" content="" />
    <meta name="dc.identifier" scheme="URI" content="" />
    <meta name="dc.date.created" scheme="W3CDTF" content="" />
    <meta name="dc.date.issued" scheme="W3CDTF" content="" />
    <meta name="dc.date.modified" scheme="W3CDTF" content="" />
    <!--PRIMARY-->
    
    <!--CONTROLLED-->
    <meta name="dc.subject" scheme="gccore" content="" />
    <meta name="Keywords" content="" />
    <meta name="dc.type" scheme="oncatype" content="" />
    <!--CONTROLLED-->
    
    <!--FACEBOOK-->
    <meta property="og:type" content="article" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <!--FACEBOOK-->	
	
	<!--SECONDARY-->
    <meta name="dc.format" scheme="IMT" content="text/html" />
    <meta name="dc.creator" content="Government of Ontario, Ministry of the Environment" />
    <meta name="dc.publisher" content="Government of Ontario, Ministry of the Environment" />
    <meta name="dc.contributor" content="Government of Ontario, Ministry of the Environment" />
    <meta name="dc.language" scheme="ISO639-2" content="Eng" />
    <meta name="dc.coverage.jurisdiction" content="Province of Ontario" />
    <meta name="dc.coverage.spatial" content="Ontario, Canada" />
    <meta name="dc.rights.intellectualProperty" content="Copyright: Queen's Printer for Ontario, 2010" />
    <meta name="go.contact.content" content="" />
    <meta name="go.contact.technical" content="" />
    <!--SECONDARY-->
 
	<link rel="stylesheet" href="http://www.ene.gov.on.ca/stdprodconsume/fragments/ministrystylesheets/css/new.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="http://www.ene.gov.on.ca/stdprodconsume/fragments/ministrystylesheets/css/master.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="http://www.ene.gov.on.ca/stdprodconsume/fragments/ministrystylesheets/css/changeme.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="http://www.ene.gov.on.ca/stdprodconsume/fragments/ministrystylesheets/css/print.css" type="text/css" media="print" />
	<link rel="stylesheet" href="http://www.ene.gov.on.ca/stdprodconsume/fragments/ministrystylesheets/css/mobile.css" type="text/css" media="handheld" />
 
	<link rel="icon" type="image/png" href="http://www.ene.gov.on.ca/stdprodconsume/fragments/ministrystylesheets/images/trillium4.ico" />
	
	<script type="text/javascript" src="http://www.ene.gov.on.ca/stdprodconsume/fragments/ministryscripts/scripts/scripts.js"></script>
 
	<style type="text/css">
      .js #smenu3 {display:none;}
      .js #smenu4 {display:none;}
      .js #smenu5 {display:none;}
      .js #smenu6 {display:none;}
      .js #smenu7 {display:none;}
    </style>
    
    <script type="text/javascript">
      document.getElementsByTagName('html')[0].className = 'js';
    </script>
	<!--MOE Geomatics Center -->
	<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="http://prod-ont-webserver.s3.amazonaws.com/moe_mapping/mapping/js/MOEMap/2.0/arcgislink.js"></script> 	
	<script type="text/javascript" src="http://prod-ont-webserver.s3.amazonaws.com/moe_mapping/mapping/js/MOEMap/js/jquery-1.7.1.min.js"></script>
	<script type="text/javascript" src="http://prod-ont-webserver.s3.amazonaws.com/moe_mapping/mapping/js/MOEMap/js/underscore-min.js"></script>
	<script type="text/html" id='TRAISTemplate'>
		<H2>Accessible Toxics Reporting Facilities and Reports</H2>
		<%
			var totalFacility = 0;
			for (var i = 0; i<facilityDict.length; i++) {
				totalFacility = totalFacility + facilityDict[i].facilityList.length
			}
		%>		
		The following <%= totalFacility %> facilities have filed Toxic Reduction reports:<P>	
		<%
			_.each(facilityDict,function(facilityEntry,key,list){
		%>
			<H3><%= facilityEntry.index %></H3>
			<%
				_.each(facilityEntry.facilityList,function(facility,key,list){
					var substance = "substance";
					if (facility.Substances > 1) {
						substance = "substances";
					} 
			%>
				<A HREF=TRAIS_Report.html?id=<%= facility.ID %>><%= facility.CompanyName %>-<%= facility.FacilityName %> [<%= facility.City %>]</A> (<%= facility.Substances %> <%= substance %>)<BR>
			<%
				});
			%>				
		<%
			});
		%>			
	</script>
	<!--MOE Geomatics Center -->
	<meta content="MSHTML 6.00.2900.3698" name="GENERATOR" />
 
</head>
 
<body id="home">
 
<div id="wrapper">
 
  <div id="header"> 
  
    <script type="text/javascript" src="http://www.ene.gov.on.ca/stdprodconsume/groups/lr/@enetemplates/documents/developerfile/moe_header.js"></script>
  
</div>
 
  <a name="top" id="top"></a>
  
  <div id="right_column">
 
    <div class="row">
      
    </div>
 
	<a name="content" id="content"></a>
    
    <!-- ENTER YOUR CONTENT HERE - BEGIN -->
	<div id="target"></div>
    
    <!-- ENTER YOUR CONTENT HERE - END -->    
 
  </div>
 
  <div id="left_column">
 
 	<div class="leftnav">
      <div class="photocap nav_top mycolour">&nbsp;</div>
      <div class="mycolour"><h2 class="header"><a style="display:block;" href="javascript:void(0)" onclick="showHide('smenu1');return false;">Toxics Information <img src="http://www.ene.gov.on.ca/stdprodconsume/fragments/ministrystylesheets/images/arrow_down.gif" width="9" height="9" alt="" title="Open the explore menu" id="smenu1_arrow" /></a></h2></div>
      <ul class="menu clear" id="smenu1" style="display:block;">
        <li><a href="http://www.ene.gov.on.ca/environment/en/subject/toxics/index.htm">Reducing Toxics</a></li>
        <li><a href="http://www.ene.gov.on.ca/environment/en/resources/collection/data_downloads/index.htm#Toxics">Data Downloads</a></li>
        <li><a href="http://www.ene.gov.on.ca/environment/en/mapping/trais/STDPROD_101839.html">Help</a></li>
        <li><a href="http://www.ene.gov.on.ca/environment/en/mapping/trais/">Toxics Map</a></li>
        <li><a href="oda.html">Accessible Version</a></li>
        <!-- <li><a href="oda.html">Text-Only Version</a></li>-->
      </ul>  
    </div>
    
    <div id="second_nav"></div>
	
	<script type="text/javascript" src="http://www.ene.gov.on.ca/stdprodconsume/groups/lr/@enetemplates/documents/developerfile/moe_secondary.js"></script>
  
  </div>
 
  <div id="footer">
    
    <script type="text/javascript" src="http://www.ene.gov.on.ca/stdprodconsume/groups/lr/@enetemplates/documents/developerfile/moe_footer.js"></script>
 
  </div>
 
</div>
	<!--MOE Geomatics Center -->
 	<script type="text/javascript">
		// Production steps of ECMA-262, Edition 5, 15.4.4.19
		// Reference: http://es5.github.com/#x15.4.4.19
		if (!Array.prototype.map) {
			Array.prototype.map = function(callback, thisArg) {

				var T, A, k;

				if (this === null) {
					throw new TypeError(" this is null or not defined");
				}

				// 1. Let O be the result of calling ToObject passing the |this| value as the argument.
				var O = Object(this);

				// 2. Let lenValue be the result of calling the Get internal method of O with the argument "length".
				// 3. Let len be ToUint32(lenValue).
				var len = O.length >>> 0;

				// 4. If IsCallable(callback) is false, throw a TypeError exception.
				// See: http://es5.github.com/#x9.11
				if (typeof callback !== "function") {
					throw new TypeError(callback + " is not a function");
				}

				// 5. If thisArg was supplied, let T be thisArg; else let T be undefined.
				if (thisArg) {
					T = thisArg;
				}

				// 6. Let A be a new array created as if by the expression new Array(len) where Array is
				// the standard built-in constructor with that name and len is the value of len.
				A = new Array(len);

				// 7. Let k be 0
				k = 0;

				// 8. Repeat, while k < len
				while(k < len) {

					var kValue, mappedValue;

					// a. Let Pk be ToString(k).
					//   This is implicit for LHS operands of the in operator
					// b. Let kPresent be the result of calling the HasProperty internal method of O with argument Pk.
					//   This step can be combined with c
					// c. If kPresent is true, then
					if (k in O) {

						// i. Let kValue be the result of calling the Get internal method of O with argument Pk.
						kValue = O[ k ];

						// ii. Let mappedValue be the result of calling the Call internal method of callback
						// with T as the this value and argument list containing kValue, k, and O.
						mappedValue = callback.call(T, kValue, k, O);

						// iii. Call the DefineOwnProperty internal method of A with arguments
						// Pk, Property Descriptor {Value: mappedValue, : true, Enumerable: true, Configurable: true},
						// and false.

						// In browsers that support Object.defineProperty, use the following:
						// Object.defineProperty(A, Pk, { value: mappedValue, writable: true, enumerable: true, configurable: true });

						// For best browser support, use the following:
						A[ k ] = mappedValue;
					}
					// d. Increase k by 1.
					k++;
				}

				// 9. return A
				return A;
			};      
		}	
		Array.range = function (a, b, step) {
			var A = [];
			if (typeof a == 'number') {
				A[0] = a;
				step = step || 1;
				while (a + step <= b) {
					A[A.length] = a += step;
				}
			} else {
				var s = 'abcdefghijklmnopqrstuvwxyz';
				if (a === a.toUpperCase()) {
					b = b.toUpperCase();
					s = s.toUpperCase();
				}
				s = s.substring(s.indexOf(a), s.indexOf(b) + 1);
				A = s.split('');
			}
			return A;
		}		
		var layer = new gmaps.ags.Layer('http://lrcdrrvsdvap002/ArcGIS/rest/services/Interactive_Map_Public/TRAIS/MapServer/0');
		var params = {
			where: "ID < 498",
			outFields: ["ID", "OrganizationName", "FacilityName", "Address", "NUMsubst"]
		};
		var facilityDict = [];		
		layer.query(params, function (rs) {
			var fs = rs.features;
			var resultsArray1 = Array.range(0, fs.length - 1).map(function (i) {
				attr = fs[i].attributes;
				return {
					CompanyName: attr.OrganizationName,
					FacilityName: attr.FacilityName,
					ID: attr.ID,
					City: attr.Address.split("/")[1],
					Substances: attr.NUMsubst
				}; 
			});
			var layer2 = new gmaps.ags.Layer('http://lrcdrrvsdvap002/ArcGIS/rest/services/Interactive_Map_Public/TRAIS/MapServer/0');
			var params2 = {
				where: "ID >= 498",
				outFields: ["ID", "OrganizationName", "FacilityName", "NPRI_ID", "Address", "NUMsubst"]
			};
			layer2.query(params2, function (rs) {
				var fs = rs.features;
				var resultsArray2 = Array.range(0, fs.length - 1).map(function (i) {
					attr = fs[i].attributes;
					return {
						CompanyName: attr.OrganizationName,
						FacilityName: attr.FacilityName,
						ID: attr.ID,
						City: attr.Address.split("/")[1],
						Substances: attr.NUMsubst
					}; 
				});	
				resultsArray = resultsArray1.concat(resultsArray2);
				var resultDict = {};
				resultsArray.map(function (result) {
					var firstLetter = result.CompanyName[0];
					if (resultDict.hasOwnProperty(firstLetter)) {
						resultDict[firstLetter].push(result);
					} else {
						resultDict[firstLetter] = [result];
					}
				});
				for(var propt in resultDict){
					facilityDict.push({
						index: propt,
						facilityList: resultDict[propt]
					});
				}
				facilityDict.sort(function compare(a,b) {
					if (a.index < b.index)
						return -1;
					if (a.index > b.index)
						return 1;
					return 0;
				});
				var template = $("#TRAISTemplate").html();		
				$("#target").html(_.template(template, facilityDict));							
			});			
		});
		
		//${TRAIS_DATA}
		//var template = $("#TRAISTemplate").html();		
		//$("#target").html(_.template(template, facilityDict));
	</script>
	<!--MOE Geomatics Center -->	
</body>
 
</html>

